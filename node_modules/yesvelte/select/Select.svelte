<script>import { get_current_component } from "svelte/internal";
import { El } from "../el";
export let componentName = "select";
export let items = [];
export let key = void 0;
export let name = void 0;
export let size = void 0;
export let disabled = void 0;
export let multiple = void 0;
export let placeholder = void 0;
export let state = void 0;
export let value = multiple ? [] : void 0;
const components = [
  { component: get_current_component(), except: [] },
  ...$$props.components ?? []
];
let cssProps = {};
let props = {};
$: {
  cssProps = { size, state };
  props = {
    componentName,
    value,
    disabled,
    placeholder,
    name
  };
}
$:
  getKey = (item) => {
    if (typeof item === "object") {
      if (key) {
        return typeof key === "string" ? item[key] : key(item);
      }
      return JSON.stringify(item);
    } else {
      return item;
    }
  };
function parse(item) {
  if (typeof items[0] === "object") {
    if (!key) {
      return JSON.parse(item);
    }
  }
  return item;
}
const onChange = (event) => {
  if (multiple) {
    value = Array.from(event.target.selectedOptions).map((option) => parse(option.value));
  } else {
    const selected = event.target.value;
    value = parse(selected);
  }
};
const isSelected = (item) => {
  if (multiple) {
    return value?.findIndex((x) => getKey(x) === getKey(item)) > -1;
  }
  return value === getKey(item);
};
</script>

<El
	tag="select"
	{components}
	{multiple}
	bind:value
	{...$$restProps}
	{...props}
	{cssProps}
	on:change={onChange}>
	{#if items}
		{#if value == undefined}
			<option disabled selected>{placeholder ? placeholder : ''}</option>
		{/if}
		{#each items as item, index}
			<option value={getKey(item)} selected={isSelected(item)}>
				<slot {index} {item}>{item}</slot>
			</option>
		{/each}
	{:else}
		<slot />
	{/if}
</El>
